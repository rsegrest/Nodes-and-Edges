/**
 * This is a p5.js sketch made with p5js-template-petr-plus.
 *
 * @license CC0-1.0
 */
!function(e){"use strict";class t{constructor(e,t){this.x=e,this.y=t,this.x=e,this.y=t}toString(){return`Position:(x:${this.x}, y:${this.y})`}static getDistance(e,t){const s=e.x-t.x,i=e.y-t.y;return Math.sqrt(s*s+i*i)}getDistance(e){return t.getDistance(this,e)}}class s{constructor(e){this.width=0,this.height=0,this.width=e.width,this.height=e.height}createInstance(e){return null===s.instance&&(s.instance=new s(e)),s.instance}getInstance(){if(null===s.instance)throw new Error("Layout instance is not created yet");return s.instance}static getDistance(e,t){const s=e.x-t.x,i=e.y-t.y;return Math.sqrt(s*s+i*i)}}s.instance=null,s.BASE_NODE_WIDTH=100,s.BASE_NODE_HEIGHT=50;class i{constructor(e,t,s,i,n=null,o=null){this._isClickable=!0,this._isSelectable=!1,this._isDraggable=!1,this._isResizable=!1,this.position=null,this.dimensions=null,this.isVisible=!0,this.isSelected=!1,this.isRolledOver=!1,this._isClickable=e,this._isDraggable=t,this._isResizable=s,this._isSelectable=i,n&&(this.position=n),o&&(this.dimensions=o)}checkMouseOver(e,t){const s=this.getBoundary();if(!s)return!1;return e>=s.left&&e<=s.right&&t>=s.top&&t<=s.bottom}getIsDraggable(){return this._isDraggable}getIsClickable(){return this._isClickable}getIsResizable(){return this._isResizable}setPosition(e){this.position=e}getPosition(){return this.position}setDimensions(e){this.dimensions=e}getDimensions(){return this.dimensions}getBoundary(e=0){return this.getPosition()&&this.getPosition()?{left:this.position.x-e,top:this.position.y-e,right:this.position.x+this.dimensions.width+e,bottom:this.position.y+this.dimensions.height+e}:null}setVisible(e=!0){this.isVisible=e}setHidden(e=!0){this.isVisible=!e}getIsVisible(){return this.isVisible}getIsHidden(){return!this.isVisible}getIsRolledOver(){return this.isRolledOver}setIsRolledOver(e=!0){this.isRolledOver=e}getIsSelected(){return this.isSelected}setIsSelected(e=!0){this.isSelected=e}getIsSelectable(){return this._isSelectable}setSelectable(e=!0){this._isSelectable=e}}class n extends i{constructor(e=null,t=null,s=!1){super(!0,!0,!0,s,e,t),this.isResizable=s,this.isDragging=!1}setCursor(e){const t=document.getElementById("defaultCanvas0");let s="pointer";e&&(s="grab"),console.log("defaultCanvas"),console.log(t);t.style.cursor=s}setIsDragging(e){this.isDragging=e}getIsDragging(){return this.isDragging}}class o extends n{constructor(e,t,s=!1){super(t,null,!1),this.plugPosition=e,this.isHighlit=s,this.plugSocket=null,this.plugPosition=e,this.position=t}dragToPosition(e){throw new Error("Method not implemented.")}clickAction(){throw new Error("Method not implemented.")}checkMouseOver(e,i){if(null!==this.position){return s.getDistance(this.position,new t(e,i))<15}return!1}plugIn(e){this.plugSocket=e}toString(){return`Plug: ${this.plugPosition}, position: ${this.position}, plugSocket: ${this.plugSocket}`}setIsHighlit(e=!0){this.isHighlit=e}getIsHighlit(){return this.isHighlit}}const r="N",l="S",c="E",h="W",g="NE",d="NW",a="SE",u="SW";class p extends n{constructor(e,t,s,i){super(s,i),this.id=e,this.label=t,this.position=s,this.dimensions=i,this.showNodes=!1,this.id=e,this.label=t,this.position=s,this.dimensions=i,this.plugs=this.createPlugs()}getBoundary(){return super.getBoundary(10)}createPlugs(){const e=[],t=[d,u,a,g,r,l,c,h];for(let s=0;s<8;s++){const i=new o(t[s],this.getPlugPosition(t[s]));e.push(i)}return e}setSelected(e=!0){this.isSelected=e}deselect(){this.isSelected=!1}getIsSelected(){return this.isSelected}getPlugPosition(e){const s=this.position.x,i=this.position.y,n=this.dimensions.width,o=this.dimensions.height;switch(e){case d:return new t(s+3,i);case r:return new t(s+3+n/2,i);case g:return new t(s+3+n,i);case u:return new t(s+3,i+o);case l:return new t(s+3+n/2,i+o);case a:return new t(s+3+n,i+o);case h:return new t(s+3,i+o/2);case c:return new t(s+3+n,i+o/2);default:return new t(0,0)}}highlightClosestPlug(e,t){this.plugs.forEach((e=>{e.setIsHighlit(!1)}));const s=this.getPlugClosestToMouse(e,t);s&&s.setIsHighlit()}getPlugClosestToMouse(e,s){let i=null,n=1e5;for(let o=0;o<this.plugs.length;o++){const r=this.plugs[o],l=r.position.getDistance(new t(e,s));l<n&&(n=l,i=r)}return i}getID(){return this.id}getLabel(){return this.label}getShowNodes(){return this.showNodes}getPlugs(){return this.plugs}getPlugByPosition(e){return this.plugs.find((t=>t.plugPosition===e))}setIsRolledOver(e=!0){this.isRolledOver=e}getIsRolledOver(){return this.isRolledOver}clickAction(){console.log("NodeModel onClick",this.toString())}setIsDragging(e){this.setCursor(e),this.isDragging=e,this.plugs.forEach((e=>{e.setIsDragging(!0)}))}dragToPosition(e){console.log(`NodeModel dragToPosition ${e.toString()}`);const s=this.position;this.position=e;const i=e.x-s.x,n=e.y-s.y;this.plugs.forEach((e=>{null!==e&&e.setPosition(new t(e.position.x+i,e.position.y+n))}))}toString(){return`NodeModel: ${this.id} ${this.label} ${this.position.toString()} ${this.dimensions.toString()}`}}class m{constructor(e,t){this.width=e,this.height=t}toString(){return`Dimension:(width:${this.width},  height:${this.height})`}}class w extends n{constructor(e,t,s,i=null,n=null){super(i,n,!1),this.name=e,this.name=e,this.icon=t,this.objectType=s}getName(){return this.name}getIcon(){return this.icon}getObjectType(){return this.objectType}clickAction(){console.log("tool clicked")}dragToPosition(e){console.log("tool dragged to position:  ",e)}}class f{constructor(){this.toolList=[],this.dimensions=new m(190,580),this.position={x:600,y:10},this.isCollapsed=!1,this.toolList.push(new w("Element","E","Element")),this.toolList.push(new w("Subelement","S","Subelement")),this.toolList.push(new w("Edge","E","Edge"))}getToolList(){return this.toolList}getDimensions(){return this.dimensions}setDimensions(e){this.dimensions=e}getPosition(){return this.position}setPosition(e){this.position=e}setIsCollapsed(e=!0){this.isCollapsed=e}getIsCollapsed(){return this.isCollapsed}getBoundary(){return{left:this.position.x,top:this.position.y,right:this.position.x+this.dimensions.width,bottom:this.position.y+this.dimensions.height}}checkMouseOver(e,t){const s=this.getBoundary();return e>=s.left&&e<=s.right&&t>=s.top&&t<=s.bottom}}class b{constructor(e){b.p=e}static plotLinesBetweenNodes(e,s){const i=e.position.x+e.dimensions.width/2,n=e.position.y+e.dimensions.height/2,o=s.position.x+s.dimensions.width/2,r=s.position.y+s.dimensions.height/2,l=i+(o-i)/2,c=l,h=r,g=new t(l,n),d=new t(c,h);return[new t(i,n),g,d,new t(o,r)]}static renderLines(e,t="rgb(200,0,0)"){const s=b.p;s.push(),s.noFill(),s.strokeWeight(3),s.stroke(t);for(let t=1;t<e.length;t+=1){const i=e[t-1],n=e[t];s.line(i.x,i.y,n.x,n.y)}s.pop()}static render(e){const t=e.getSourceNode(),s=e.getTargetNode(),i=this.plotLinesBetweenNodes(t,s);this.renderLines(i)}}class S{constructor(e){S.p=e}static render(){const e=S.p;e.push(),e.noFill(),e.strokeWeight(1),e.stroke("rgb(255,255,255,0.5)");for(let t=1;t<e.width/100;t+=1)e.line(100*t,0,100*t,e.height);for(let t=1;t<e.height/100;t+=1)e.line(0,100*t,e.width,100*t);e.pop()}static getP(){return S.p}}class P{constructor(e){this.isSelected=!1,P.p=e}static renderPlug(e,t,s){if(null===e)return;const i=e.getPosition();if(null===i)return;const n=e.getIsSelected(),o=i.x,r=i.y;let l="rgba(200,200,200,0.7)",c="rgba(255,255,200,0.7)";e.checkMouseOver(t.mouseX,t.mouseY)&&(l="rgba(255,255,72,1)",c="rgba(0,0,0,0.8)"),n&&(l="rgba(255,0,72,1)",c="rgba(255,0,72,1)"),e.getIsHighlit()&&(l="rgba(0,0,255,1)",c="rgba(0,255,255,1)"),t.push(),t.stroke(l),t.strokeWeight(2),t.fill(c),(n||s)&&t.circle(o,r,8),t.pop()}static showNodes(e,t,s){e.getPlugs().forEach((e=>{this.renderPlug(e,t,s)}))}static render(e,t,s=!1){const i=10,n=e.getBoundary(),o=e.dimensions.width,r=e.dimensions.height,l=e.position.x,c=e.position.y,h=e.getLabel();let g="rgba(228,200,200,1)";e.getIsSelected()&&(g="rgba(255,255,200,1)"),t.push(),t.translate(l,c),t.noStroke(),t.fill("rgba(0,0,0,0.5)");let d="rgb(128,128,128)",a=1;s&&(d="rgb(255,200,0)",a=3),t.rect(0,5,o,r,0,i,i,i),t.fill(g),t.stroke(d),t.strokeWeight(a),t.rect(3,0,o,r,0,i,i,i),t.fill(0),t.noStroke(),t.textAlign(t.CENTER,t.CENTER),t.text(h,6,3,o-6,r-6),t.pop();const u=e.getIsRolledOver();this.showNodes(e,t,u),P.drawRolloverGuide(n,t)}static drawRolloverGuide(e,t){t.push(),t.noFill(),t.stroke("rgb(0,255,255)"),t.strokeWeight(1),t.translate(e.left,e.top),t.rect(0,0,e.right-e.left,e.bottom-e.top),t.pop()}}class I{constructor(e){I.p=e}static getP(){return I.p}static renderTool(e,t){const s=I.getP();s.push(),s.translate(t.x,t.y),s.fill("rgba(255,200,100,1)"),s.stroke(72),s.strokeWeight(2),s.rectMode(s.CENTER),s.rect(0,0,80,40),s.noStroke(),s.fill(0),s.text(e.getName(),-30,5),s.pop()}}class E{constructor(e){E.p=e}static getP(){return E.p}static renderTitle(e){const t=E.getP(),s=e.getPosition();t.push(),t.fill(255),t.noStroke(),t.text("TOOLBOX",s.x+10,s.y+20),t.push()}static renderTitleBar(e){const t=E.getP(),s=e.getPosition(),i=e.getDimensions();t.push(),t.fill("rgba(32,32,64,0.8)"),t.noStroke(),t.rect(s.x,s.y,i.width,30),t.fill(255),t.text("TOOLBOX",s.x+10,s.y+20),t.pop(),E.renderTitle(e)}static calcNumToolGridColumns(){return 2}static calcNumToolGridRows(){return 6}static findFirstRowOffset(e){return 70+e.getPosition().y}static findHorizontalCenterLine(e){return e.getPosition().x+95}static findRowCenterLine(e,t){return E.findFirstRowOffset(e)+t*E.ROW_SPACING}static buildLocationSet(e){const s=e.getPosition(),i=e.getToolList(),n=[];return i.forEach(((i,o)=>{let r=this.findHorizontalCenterLine(e)-45;o%2!=0&&(r+=90),n.push(new t(r,s.y+E.findFirstRowOffset(e)+60*Math.floor(o/2)))})),n}static renderTools(e){const t=e.getToolList(),s=E.buildLocationSet(e);t.forEach(((e,t)=>{I.renderTool(e,s[t])}))}static render(e){const t=E.getP();e.getPosition(),e.getDimensions(),E.renderBackground(e),E.renderTBBorder(e),E.renderTitleBar(e),E.renderTools(e),t.pop()}static renderBackground(e){const t=E.getP(),s=e.getPosition(),i=e.getDimensions();t.push(),t.fill("rgba(255,255,255,0.2)"),t.noStroke(),t.rect(s.x,s.y+30,i.width,i.height-30),t.pop()}static renderTBBorder(e){const t=E.getP(),s=e.getPosition(),i=e.getDimensions();t.noFill(),t.stroke("rgba(32,32,64,0.8)"),t.strokeWeight(3),t.rect(s.x,s.y,i.width,i.height)}}E.ROW_SPACING=60;class y{constructor(){}static createInstance(){return y.instance||(y.instance=new y),y.instance}static getInstance(){if(!y.instance)throw new Error("CreationManager instance is not created yet");return y.instance}createNodeModel(e,t,s,i){return new p(e,t,s,i)}createPlug(e,t){return new o(e,t)}static populateNodeAndEdgeList(){const e=y.createNodes();return{nodes:e,edges:y.createEdges(e)}}static createNodes(){const e=[],s=["Solar Array","Cable","Avionics","Radiator"];for(let i=0;i<4;i+=1){const n=(i+1).toString(),o=s[i],r=new t(10+150*i+10*i,20),l=new m(100,50),c=new p(n,o,r,l);e.push(c)}return e}static createEdges(e){return[]}}class k{constructor(e){this.nodes=[],this.edges=[],this.toolbox=new f,this.rolledOverObjects=[],k.setP(e),this.nodes=y.createNodes()}mouseDragged(e){const t=this.getDragTarget();t instanceof p&&(console.log("this is a node"),t.setIsDragging(!0))}mousePressed(e){}clearDragTargets(){this.nodes.forEach((e=>e.setIsDragging(!1))),this.edges.forEach((e=>e.setIsDragging(!1)))}mouseReleased(e){console.log("mouse released"),this.clearDragTargets()}getDragTarget(){const e=this.nodes,t=this.edges,s=this.nodes.flatMap((e=>e.getPlugs()));if(s.length>0)for(let e=0;e<s.length;e+=1){const t=s[e];if(void 0!==t&&(null!==t&&t.getIsRolledOver()))return console.warn(`plug: ${t.toString()} is rolled over`),t}if(t.length>0)for(let e=0;e<t.length;e+=1){const s=t[e];if(void 0!==s&&(null!==s&&(null==s?void 0:s.getIsRolledOver())))return console.warn(`edge: ${s.toString()} is rolled over`),s}if(e.length>0)for(let t=0;t<e.length;t+=1){const s=e[t];if(void 0!==s&&(null!==s&&(null==s?void 0:s.getIsRolledOver())))return console.warn(`node: ${s.toString()} is rolled over`),s}return null}drawTestLines(){const e=b.plotLinesBetweenNodes(this.nodes[0],this.nodes[1]),t=b.plotLinesBetweenNodes(this.nodes[1],this.nodes[2]),s=b.plotLinesBetweenNodes(this.nodes[2],this.nodes[3]);b.renderLines(e),b.renderLines(t),b.renderLines(s,"rgb(0,0,200)")}renderElements(){const e=k.getP();this.nodes.forEach(((s,i)=>{if(s.checkMouseOver(e.mouseX,e.mouseY)?s.setIsRolledOver():s.setIsRolledOver(!1),s.getIsDragging()&&s.dragToPosition(new t(e.mouseX-40,e.mouseY-20)),this.getSelectedNodes().length>0){const s=this.getClosestPlugsOnSelectedNode()[0],i=[null==s?void 0:s.getPosition(),new t(e.mouseX,e.mouseY)];b.renderLines(i,"rgb(0,128,255)")}P.render(s,k.getP()),E.render(this.toolbox)})),S.render()}testAddHtmlDiv(){const e=document.createElement("p");e.innerHTML="This is an HTML div appended to a top-layer div";const t=document.getElementById("htmlContainer");null==t||t.appendChild(e)}static createContainer(e,t){const s=document.createElement("div");return t.appendChild(s),{container:s}}getSelectedNodes(){return this.nodes.filter((e=>e.getIsSelected()))}getRolledOverNodes(){return this.nodes.filter((e=>e.getIsRolledOver()))}checkForSelectNode(){const e=new t(k.p.mouseX,k.p.mouseY);for(let t=0;t<this.nodes.length;t+=1)if(null!==this.nodes[t]&&void 0!==this.nodes[t]){const s=this.nodes[t];s.setSelected(!1),s.checkMouseOver(e.x,e.y)&&s.setSelected()}}getClosestPlugsOnSelectedNode(){const e=this.getSelectedNodes(),t=[];if(e.length>0)for(let s=0;s<e.length;s+=1){const i=e[s].getPlugClosestToMouse(k.p.mouseX,k.p.mouseY);t.push(i)}return t}mouseClicked(){console.log(`ChartManager.mouseClicked() @ ${new t(k.p.mouseX,k.p.mouseY)}`),this.nodes.forEach(((e,t)=>{e.getPlugs().forEach((e=>{e.checkMouseOver(k.p.mouseX,k.p.mouseY)&&e.setIsSelected()})),this.checkForSelectNode()}))}addNode(e){this.nodes.push(e)}removeNode(e){const t=this.nodes.indexOf(e);t>-1&&this.nodes.splice(t,1)}addEdge(e){this.edges.push(e)}removeEdge(e){const t=this.edges.indexOf(e);t>-1&&this.edges.splice(t,1)}getNodes(){return this.nodes}getEdges(){return this.edges}selectNode(e){e.setSelected()}deselectNode(e){e.deselect()}static createInstance(e){return null===k.instance&&(k.instance=new k(e)),k.instance}static getInstance(){if(null===k.instance)throw new Error("ChartManager instance is not created yet");return k.instance}static setP(e){k.p=e}static getP(){return k.p}toString(){let e=`ChartManager:\n\t${this.nodes.length} nodes,\n\t${this.edges.length}\n`;return e+="NODES: [\n\t",this.nodes.forEach((t=>{e+=`\t${t.toString()},\n`})),e+="]\nEDGES: [\n\t",this.edges.forEach((t=>{e+=`\t${t.toString()},\n`})),e+="",e}}let v;k.instance=null;let N;const O=(e=>{const t=Object.keys(e);return s=>{t.forEach((t=>{const i=e[t];i&&(s[t]=i.bind(void 0,s))}))}})({preload:e=>{e.loadFont("./font/Regular.otf")},setup:e=>{e.createCanvas(800,600),e.frameRate(30),e.background(248),(e=>{new P(e),new b(e),new S(e),new I(e),new E(e)})(e),v=k.createInstance(e),y.createInstance()},draw:e=>{N=e,N.background("rgb(180,180,200)"),v.renderElements()},mouseClicked:function(){v.mouseClicked()},mouseDragged:e=>{k.getInstance().mouseDragged(e)},mousePressed:e=>{k.getInstance().mousePressed(e)},mouseReleased:e=>{k.getInstance().mouseReleased(e)}});new e(O)}(p5);